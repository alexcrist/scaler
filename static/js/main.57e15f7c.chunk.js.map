{"version":3,"sources":["components/AddTrack/AddTrack.module.css","components/Chart/Chart.module.css","components/Play/Play.module.css","components/Save/Save.module.css","components/TimelineArm/TimelineArm.module.css","components/TrackOptions/TrackOptions.module.css","constants/notes.js","constants/scales.js","util/scalePlayer.js","util/stateHasher.js","util/formulaEvaluator.js","util/audioPlayer.js","constants/colors.js","util/stateLoader.js","util/localStorage.js","components/AddTrack/AddTrack.js","components/Chart/Chart.js","components/EnabledNotes/EnabledNotes.js","components/LoopOptions/LoopOptions.js","util/midiWriter.js","components/More/More.js","util/fileDownloader.js","components/Play/Play.js","components/Save/Save.js","components/TimelineArm/TimelineArm.js","components/Title/Title.js","components/TrackOptions/TrackOptions.js","components/App/App.js","util/noteCalculator.js","index.js","components/LoopOptions/LoopOptions.module.css","components/More/More.module.css","components/App/App.module.css","components/EnabledNotes/EnabledNotes.module.css","components/Title/Title.module.css"],"names":["module","exports","NOTES","FREQS","length","Error","NOTE_MAP","i","masterVolume","SCALES","name","pitches","map","scale","notes","note","pitch","substring","includes","push","toHash","stateObject","str","JSON","stringify","LZString","compressToEncodedURIComponent","fromHash","hash","decompressFromEncodedURIComponent","parse","formulaToData","formula","xValues","replace","yValues","x","y","evaluate","e","wasCapped","isNaN","console","error","cap","play","freq","noteStart","noteDuration","context","Number","localVolume","createGain","connect","gain","setValueCurveAtTime","Float32Array","v","currentTime","oscillator","createOscillator","frequency","setValueAtTime","start","stop","window","AudioContext","webkitAudioContext","numPlays","playScale","dataRef","wasPlaying","playId","current","tracks","bpm","numBeats","isPlaying","destination","msPerBeat","msPerLoop","j","isMuted","disabledBeats","k","isBeatDisabled","delay","setTimeout","COLORS","OPACITY_1","GRAY_1","defaultData","noteRange","lowNote","color","loadInitialState","queryString","location","search","data","URLSearchParams","get","localStorage","getItem","loadLocal","AddTrack","setTracks","onClick","lastColor","newColorIndex","indexOf","newTrack","className","styles","createTrack","style","borderColor","backgroundColor","createTrackText","Chart","numXValues","Math","PI","yValuesArray","track","xLines","ReferenceLine","strokeDasharray","yLines","yMin","floor","_","flatten","min","yMax","ceil","max","range","inc","log10","container","ResponsiveContainer","width","height","LineChart","Line","type","dataKey","stroke","opacity","dot","strokeWidth","Tooltip","formatter","__","properties","payload","trackIndex","beatIndex","round","labelFormatter","label","YAxis","domain","hide","EnabledNotes","setTrack","buttonStyle","buttons","buttonClasses","button","disabled","wasEnabled","splice","join","buttonsClasses","muted","Input","props","inputStyle","inputGroup","input","Select","options","display","onChange","initialValue","option","value","selected","LoopOptions","setScale","setLowNote","setBpm","setNumBeats","setNoteRange","containerStyle","selectableNotes","filter","number","target","noteIndex","scaleIndex","newScale","oldLowNoteIndex","newLowNote","msToTicks","ms","tempo","seconds","ExportToMidi","setIsVisible","filename","textContent","element","document","createElement","setAttribute","body","appendChild","click","removeChild","downloadFile","midiTracks","midiTrack","MidiWriter","Track","setTempo","isDisabled","startMs","maxNoteDuration","Infinity","duration","midiNote","NoteEvent","startTick","addEvent","Writer","dataUri","toMidiString","OverflowMenu","isVisible","classes","overflowMenu","hidden","More","useState","moreRef","useRef","useEffect","handleClickOutside","contains","addEventListener","removeEventListener","ref","moreContainer","title","more","moreIcon","Play","setIsPlaying","text","playStyle","playText","Save","onSave","save","saveIcon","playAnimation","gsap","fromTo","left","ease","repeat","pauseAnimation","TimelineArm","armRef","periodDuration","arm","Title","line","link","href","index","isError","inputError","Inputs","isFormulaValid","createAttributeSetter","attribute","editable","Icons","isCollapsed","muteClasses","icon","MuteIcon","FaVolumeMute","FaVolumeDown","icons","muteIcon","trashIcon","TrackOptions","setIsCollapsed","containerClasses","collapsed","header","App","useMemo","minNoteIndex","calculateNotes","scalePlayerData","disconnect","history","pushState","origin","pathname","setItem","saveLocal","a","url","navigator","clipboard","writeText","alert","prompt","createSetTrack","newTracks","cloneDeep","app","row","chart","right","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.57e15f7c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"createTrack\":\"AddTrack_createTrack__1dZTK\",\"createTrackText\":\"AddTrack_createTrackText__3wNni\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Chart_container__1PIOn\",\"cap\":\"Chart_cap__21rfP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"play\":\"Play_play__2x_Gd\",\"playText\":\"Play_playText__1skLF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"save\":\"Save_save__3A0OR\",\"saveIcon\":\"Save_saveIcon__2J_5P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"arm\":\"TimelineArm_arm__2cLiz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"TrackOptions_container__2E_dx\",\"collapsed\":\"TrackOptions_collapsed__X5vja\",\"header\":\"TrackOptions_header__3Lfwo\",\"icons\":\"TrackOptions_icons__33YYK\",\"icon\":\"TrackOptions_icon__3jQrz\",\"isMuted\":\"TrackOptions_isMuted__4aVJB\",\"muteIcon\":\"TrackOptions_muteIcon__175TR\",\"trashIcon\":\"TrackOptions_trashIcon__30wpV\",\"title\":\"TrackOptions_title__1ue4w\",\"label\":\"TrackOptions_label__1sLEb\",\"input\":\"TrackOptions_input__3reUO\",\"inputError\":\"TrackOptions_inputError__L1BNH\"};","export const NOTES = [ \n  'C0',  'Db0', 'D0', 'Eb0', 'E0', 'F0', 'Gb0', 'G0', 'Ab0', 'A0', 'Bb0', 'B0',\n  'C1',  'Db1', 'D1', 'Eb1', 'E1', 'F1', 'Gb1', 'G1', 'Ab1', 'A1', 'Bb1', 'B1',\n  'C2',  'Db2', 'D2', 'Eb2', 'E2', 'F2', 'Gb2', 'G2', 'Ab2', 'A2', 'Bb2', 'B2',\n  'C3',  'Db3', 'D3', 'Eb3', 'E3', 'F3', 'Gb3', 'G3', 'Ab3', 'A3', 'Bb3', 'B3',\n  'C4',  'Db4', 'D4', 'Eb4', 'E4', 'F4', 'Gb4', 'G4', 'Ab4', 'A4', 'Bb4', 'B4',\n  'C5',  'Db5', 'D5', 'Eb5', 'E5', 'F5', 'Gb5', 'G5', 'Ab5', 'A5', 'Bb5', 'B5',\n  'C6',  'Db6', 'D6', 'Eb6', 'E6', 'F6', 'Gb6', 'G6', 'Ab6', 'A6', 'Bb6', 'B6',\n  'C7',  'Db7', 'D7', 'Eb7', 'E7', 'F7', 'Gb7', 'G7', 'Ab7', 'A7', 'Bb7', 'B7',\n  'C8',  'Db8', 'D8', 'Eb8', 'E8', 'F8', 'Gb8', 'G8', 'Ab8', 'A8', 'Bb8', 'B8'\n];\n\nexport const FREQS = [\n  16.35, 17.32, 18.35, 19.45, 20.60, 21.83, 23.12, 24.50, 25.96, 27.50, 29.14, \n  30.87, 32.70, 34.65, 36.71, 38.89, 41.20, 43.65, 46.25, 49.00, 51.91, 55.00, \n  58.27, 61.74, 65.41, 69.30, 73.42, 77.78, 82.41, 87.31, 92.50, 98.00, 103.83, \n  110.00, 116.54, 123.47, 130.81, 138.59, 146.83, 155.56, 164.81, 174.61, 185.00, \n  196.00, 207.65, 220.00, 233.08, 246.94, 261.63, 277.18, 293.66, 311.13, 329.63, \n  349.23, 369.99, 392.00, 415.30, 440.00, 466.16, 493.88, 523.25, 554.37, 587.33, \n  622.25, 659.25, 698.46, 739.99, 783.99, 830.61, 880.00, 932.33, 987.77, 1046.50,\n  1108.73, 1174.66, 1244.51, 1318.51, 1396.91, 1479.98, 1567.98, 1661.22, 1760.00, \n  1864.66, 1975.53, 2093.00, 2217.46, 2349.32, 2489.02, 2637.02, 2793.83, 2959.96, \n  3135.96, 3322.44, 3520.00, 3729.31, 3951.07, 4186.01, 4434.92, 4698.63, 4978.03, \n  5274.04, 5587.65, 5919.91, 6271.93, 6644.88, 7040.00, 7458.62, 7902.13\n];\n\nif (NOTES.length !== FREQS.length) {\n  throw Error('# notes !== # freqs');\n}\n\nexport const NOTE_MAP = {};\nfor (let i = 0; i < NOTES.length; i++) {\n  NOTE_MAP[NOTES[i]] = FREQS[i];\n}\n\n\n\n","import { NOTES } from \"./notes\";\n\nexport const SCALES = [\n  {\n    name: 'C major',\n    pitches: ['C', 'D', 'E', 'F', 'G', 'A', 'B']\n  },\n  {\n    name: 'D minor',\n    pitches: ['D', 'E', 'F', 'G', 'A', 'Bb', 'C']\n  },\n  {\n    name: 'D major',\n    pitches: ['D', 'E', 'Gb', 'G', 'A', 'B', 'Db']\n  },\n  {\n    name: 'E minor',\n    pitches: ['E', 'Gb', 'G', 'A', 'B', 'C', 'D']\n  },\n  {\n    name: 'E major',\n    pitches: ['E', 'Gb', 'G', 'A', 'B', 'C', 'D']\n  },\n  {\n    name: 'F minor',\n    pitches: ['F', 'G', 'Ab', 'Bb', 'C', 'Db', 'Eb']\n  },\n  {\n    name: 'F major',\n    pitches: ['F', 'G', 'A', 'Bb', 'C', 'D', 'E']\n  },\n  {\n    name: 'G minor',\n    pitches: ['G', 'A', 'Bb', 'C', 'D', 'Eb', 'F']\n  },\n  {\n    name: 'G major',\n    pitches: ['G', 'A', 'B', 'C', 'D', 'E', 'Gb']\n  },\n  {\n    name: 'A minor',\n    pitches: ['A', 'B', 'C', 'D', 'E', 'F', 'G']\n  },\n  {\n    name: 'A major',\n    pitches: ['A', 'B', 'Db', 'D', 'E', 'Gb', 'Ab']\n  },\n  {\n    name: 'B minor',\n    pitches: ['B', 'Db', 'D', 'E', 'Gb', 'G', 'A']\n  },\n  {\n    name: 'B major',\n    pitches: ['B', 'Db', 'Eb', 'E', 'Gb', 'Ab', 'Bb']\n  }\n].map((scale) => {\n  scale.notes = [];\n  for (const note of NOTES) {\n    const pitch = note.substring(0, note.length - 1);\n    if (scale.pitches.includes(pitch)) {\n      scale.notes.push(note);\n    }\n  }\n  return scale;\n});","import { NOTE_MAP } from '../constants/notes';\nimport { play } from './audioPlayer';\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\nconst context = new AudioContext();\nlet masterVolume;\n\nlet numPlays = 0;\n\nconst numLoopsToQueue = 4;\n\nexport const playScale = (dataRef, wasPlaying = false, playId = numPlays) => {\n\n  const {\n    tracks,\n    bpm,\n    notes,\n    numBeats,\n    isPlaying,\n  } = dataRef.current;\n\n  // Explanation of 'playId !== numPlays':\n  //   If the user stops then starts the scale without major delay,\n  //   the stopped scale will restart again seeing that isPlaying === true.\n  //   To get around this, we incorporate a 'playId' system where each call to\n  //   playScale() is associated with a unique ID so we know only to play the\n  //   latest call.\n  if (!isPlaying || playId !== numPlays) {\n    return;\n  }\n\n  if (!wasPlaying) {\n    numPlays++;\n    playId = numPlays;\n    masterVolume = context.createGain();\n    masterVolume.connect(context.destination);\n  }\n\n  const msPerBeat = (1 / (bpm * 4)) * 60 * 1000;\n  const msPerLoop = msPerBeat * numBeats;\n\n  // Queue multiple loops at a time to avoid setTimeout() unrelability\n  for (let i = 0; i < numLoopsToQueue; i++) {\n\n    for (let j = 0; j < notes.length; j++) {\n      const { noteDuration, isMuted, disabledBeats } = tracks[j];\n\n      for (let k = 0; k < notes[j].length; k++) {\n        const note = notes[j][k];\n        const freq = NOTE_MAP[note];\n        const isBeatDisabled = disabledBeats.includes(k);\n        const noteStart = i * msPerLoop + k * msPerBeat;\n        if (!isMuted && !isBeatDisabled && noteDuration) {\n          play(\n            freq,\n            noteStart,\n            noteDuration,\n            masterVolume,\n            context\n          );\n        }\n      }\n    }\n  }\n\n  // Multiply BPM times four to represent quarter\n  const delay = msPerLoop * numLoopsToQueue;\n  setTimeout(() => playScale(dataRef, true, playId), delay);\n};\n\nexport const stopScale = () => {\n  if (masterVolume) {\n    masterVolume.disconnect();\n  }\n};","import LZString from 'lz-string';\n\nexport const toHash = (stateObject) => {\n  const str = JSON.stringify(stateObject);\n  return LZString.compressToEncodedURIComponent(str);\n};\n\nexport const fromHash = (hash) => {\n  const str = LZString.decompressFromEncodedURIComponent(hash);\n  return JSON.parse(str);\n};","import { evaluate } from 'mathjs';\n\nexport const formulaToData = (formula, xValues) => {\n\n  // Validate formula\n  formula = formula.replace(/\\s+/g, '');\n  if (formula.substring(0,  2) !== 'y=') {\n    throw Error('Invalid formula: ' + formula);\n  }\n  formula = formula.substring(2);\n\n  // Calculate y-values\n  let yValues = [];\n  for (const x of xValues) {\n    try {\n      const y = evaluate(formula, { x });\n      yValues.push(y);\n    } catch (e) {\n      throw Error('Formula evaluation error: ' + formula);\n    }\n  }\n\n  // Cap big / small numbers\n  const cap = 30;\n  let wasCapped = false;\n  yValues = yValues.map((y) => {\n    if (y > cap) {\n      wasCapped = true;\n      return cap;\n    } else if (y < -cap) {\n      wasCapped = true;\n      return -cap;\n    }\n    return y;\n  });\n\n  // Convert NaN to 0\n  yValues = yValues.map((y) => isNaN(y) ? 0 : y);\n\n  // Handle bad values (functions)\n  for (const y of yValues)  {\n    if (typeof y !== 'number' || isNaN(y)) {\n      console.error('Error in y-values:', yValues);\n      throw Error('Formula produced invalid values: ' + formula);\n    }\n  }\n\n  return {\n    yValues,\n    wasCapped,\n    cap\n  };\n};\n","export const play = (\n  freq, \n  noteStart, \n  noteDuration,\n  masterVolume,\n  context\n) => {\n  freq = Number(freq);\n  noteDuration = Number(noteDuration);\n  if (isNaN(freq) || freq < 0) {\n    return;\n  }\n  if (isNaN(noteDuration) || noteDuration < 1) {\n    return;\n  }\n\n  const localVolume = context.createGain();\n  localVolume.connect(masterVolume);\n  localVolume.gain.setValueCurveAtTime(new Float32Array([0, 0.8, 1, 0.3, 0].map(v => v * 0.05)), context.currentTime + noteStart / 1000, noteDuration / 1000);\n  const oscillator = context.createOscillator();\n  oscillator.connect(localVolume);\n  oscillator.frequency.setValueAtTime(freq, 0);\n  oscillator.start(context.currentTime + noteStart / 1000);\n  oscillator.stop(context.currentTime + (noteStart + noteDuration) / 1000);\n};","export const COLOR_1 = '#8338ec';\nexport const COLOR_2 = '#ff006e';\nexport const COLOR_3 = '#3a86ff';\nexport const COLOR_4 = '#fb5607';\nexport const COLOR_5 = '#ffbe0b';\n\nexport const COLORS = [\n  COLOR_1,\n  COLOR_2,\n  COLOR_3,\n  COLOR_4,\n  COLOR_5\n];\n\nexport const OPACITY_1 = 'cc';\nexport const OPACITY_2 = '66';\nexport const OPACITY_3 = '11';\n\nexport const GRAY_1 = '#666666';","import { COLORS } from '../constants/colors';\nimport { SCALES } from '../constants/scales';\nimport { fromHash } from './stateHasher';\nimport { loadLocal } from './localStorage';\n\nconst defaultData = {\n  bpm: 60,\n  numBeats: 16,\n  noteRange: 14,\n  scale: SCALES[3],\n  lowNote: 'E3',\n  tracks: [\n    {\n      color: COLORS[0],\n      formula: 'y = min(sin(x), cos(x))',\n      noteDuration: 20,\n      disabledBeats: [1, 4, 7, 9, 10, 15],\n      isMuted: false\n    },\n    {\n      color: COLORS[1],\n      formula: 'y = (1 / (x + 0.5)) * cos(4x) - 2',\n      noteDuration: 90,\n      disabledBeats: [0, 2, 5, 6, 10, 12, 13],\n      isMuted: false\n    },\n    {\n      color: COLORS[2],\n      formula: 'y = 0',\n      noteDuration: 60,\n      disabledBeats: [0, 6, 9, 13],\n      isMuted: false\n    },\n  ]\n};\n\nexport const loadInitialState = () => {\n  const queryString = window.location.search;\n  const urlParams = new URLSearchParams(queryString);\n  let data = urlParams.get('d');\n  if (data) {\n    return fromHash(data);\n  }\n  data = loadLocal();\n  if (data) {\n    return data;\n  }\n  return defaultData;\n};\n","import { fromHash, toHash } from './stateHasher';\n\nconst KEY = 'd';\n\nexport const loadLocal = () => {\n  const hash = localStorage.getItem(KEY);\n  if (hash === null) {\n    return null;\n  }\n  return fromHash(hash);\n};\n\nexport const saveLocal = (data) => {\n  const hash = toHash(data);\n  localStorage.setItem(KEY, hash);\n};","import { COLORS, GRAY_1, OPACITY_1 } from '../../constants/colors';\nimport styles from './AddTrack.module.css';\n\nconst AddTrack = ({ tracks, setTracks }) => {\n\n  const addTrack = () => {\n    const lastColor = tracks[tracks.length - 1].color;\n    const lastColorIndex = COLORS.indexOf(lastColor);\n    const newColorIndex = (lastColorIndex + 1) % COLORS.length;\n    const newColor = COLORS[newColorIndex];\n    const newTrack = {\n      color: newColor,\n      formula: 'y = 0',\n      noteDuration: 100,\n      disabledBeats: [],\n      isMuted: false\n    };\n    setTracks([...tracks, newTrack]);\n  };\n\n  return (\n    <div\n      onClick={addTrack}\n      className={styles.createTrack}\n      style={{\n        borderColor: GRAY_1,\n        backgroundColor: GRAY_1 + OPACITY_1,\n      }}\n    >\n      <div className={styles.createTrackText}>\n        Add track\n      </div>\n    </div>\n  );\n};\n\nexport default AddTrack;","import _ from 'lodash';\nimport { Line, LineChart, ReferenceLine, ResponsiveContainer, Tooltip, YAxis } from 'recharts';\nimport { formulaToData } from '../../util/formulaEvaluator';\nimport styles from './Chart.module.css';\n\nconst H = 300;\nconst dataResolution = 20; \n\nconst Chart = ({\n  tracks,\n  numBeats,\n  notes,\n}) => {\n\n  const xValues = [];\n  const numXValues = numBeats * dataResolution;\n  for (let i = 0; i < numXValues + 1; i++) {\n    xValues.push(i * (2 * Math.PI) / numXValues);\n  }\n\n  let wasCapped = false;\n  let cap = 0;\n  const yValuesArray = tracks\n    .map((track) => {\n      try {\n        const data = formulaToData(track.formula, xValues);\n        wasCapped = wasCapped || data.wasCapped;\n        cap = data.cap;\n        return data.yValues;\n      } catch (e) {\n        return [];\n      }\n    });\n\n  const data = xValues.map((x, i) => ({ x, i }));\n\n  for (let i = 0; i < yValuesArray.length; i++) {\n    const name = `Track ${i + 1}`;\n    const yValues = yValuesArray[i];\n    for (let j = 0; j < yValues.length; j++) {\n      const y = yValues[j];\n      data[j][name] = y;\n    }\n  }\n\n  const xLines = [];\n  for (let i = 0; i < numBeats + 1; i++) {\n    xLines.push(\n      <ReferenceLine\n        key={`x-line-${i}`}\n        x={i / numBeats * numXValues}\n        strokeDasharray='3 3'\n      />\n    );\n  }\n\n  const yLines = [];\n  const yMin = Math.floor(_(yValuesArray).flatten().min());\n  const yMax = Math.ceil(_(yValuesArray).flatten().max());\n  const range = yMax - yMin;\n  const inc = Math.max(1, 10 ** Math.floor(Math.log10(range - 1)));\n  for (let i = yMin; i <= yMax; i += inc) {\n    yLines.push(\n      <ReferenceLine\n        key={`y-line-${i}`}\n        y={i}\n        strokeDasharray='3 3'\n      />\n    );\n  }\n\n  const formatter = (_, __,  properties) => {\n    const { dataKey, payload: { i } } = properties; \n    const trackIndex = Number(dataKey[dataKey.length - 1]) - 1;\n    const beatIndex = Math.round(i / dataResolution);\n    return notes[trackIndex][beatIndex];\n  };\n\n  return (\n    <div className={styles.container}>\n      <ResponsiveContainer width='100%' height={H}>\n        <LineChart\n          data={data}\n        >\n          {xLines}\n          {yLines}\n          {tracks.map((track, i) => (\n            <Line\n              key={`line-${i}`}\n              type='monotone'\n              dataKey={`Track ${i + 1}`}\n              stroke={track.color}\n              opacity={track.isMuted ? 0.4 : 1}\n              dot={false}\n              strokeWidth={2}\n            />\n          ))}\n          <Tooltip\n            formatter={formatter}\n            labelFormatter={(label) => Math.floor(label / dataResolution) + 1}\n          />\n          <YAxis domain={['dataMin', 'dataMax']} hide={true} />\n        </LineChart>\n      </ResponsiveContainer>\n      {wasCapped\n        ? <div className={styles.cap}>* y-values capped at ±{cap}</div>\n        : null\n      }\n    </div>\n  );\n};\n\nexport default Chart;","import { OPACITY_1 } from '../../constants/colors';\nimport styles from './EnabledNotes.module.css';\n\nconst EnabledNotes = ({ numBeats, track, setTrack }) => {\n\n  if (!track) {\n    return null;\n  }\n\n  const { color } = track;\n  const buttonStyle = {\n    backgroundColor: color + OPACITY_1,\n    borderColor: color\n  };\n\n  const buttons = [];\n  for (let i = 0; i < numBeats; i++) {\n\n    const onClick = () => {\n      let wasEnabled = true;\n      for (let j = 0; j < track.disabledBeats.length; j++) {\n        if (i === track.disabledBeats[j]) {\n          track.disabledBeats.splice(j, 1);\n          wasEnabled = false;\n        }\n      }\n      if (wasEnabled) {\n        track.disabledBeats.push(i);\n      }\n      setTrack({ ...track });\n    };\n\n    const buttonClasses = [styles.button];\n    if (track.disabledBeats.includes(i)) {\n      buttonClasses.push(styles.disabled);\n    }\n\n    buttons.push(\n      <div\n        key={i}\n        onClick={onClick}\n        style={buttonStyle}\n        className={buttonClasses.join(' ')}\n      >\n        {i + 1}\n      </div>\n    );\n  }\n\n  const buttonsClasses = [styles.buttons];\n  if (track.isMuted) {\n    buttonsClasses.push(styles.muted);\n  }\n\n  return (\n    <div className={buttonsClasses.join(' ')}>\n      {buttons}\n    </div>\n  )\n};\n\nexport default EnabledNotes;","import { GRAY_1, OPACITY_1 } from '../../constants/colors';\nimport { SCALES } from '../../constants/scales';\nimport styles from './LoopOptions.module.css';\n\nconst Input = (props) => {\n  const inputStyle = { borderColor: GRAY_1 };\n  return (\n    <div className={styles.inputGroup}>\n      <label className={styles.label}>\n        {props.label}\n      </label>\n      <input\n        className={styles.input}\n        style={inputStyle}\n        {...props}\n      />\n    </div>\n  );\n};\n\nconst Select = ({ options, label, display, onChange, initialValue }) => {\n  const inputStyle = { borderColor: GRAY_1 };\n  return (\n    <div className={styles.inputGroup}>\n      <label className={styles.label}>\n        {label}\n      </label>\n      <select\n        style={inputStyle}\n        className={styles.input}\n        onChange={onChange}\n      >\n        {options.map((option, i) => (\n          <option\n            value={i}\n            key={i}\n            selected={JSON.stringify(option) === JSON.stringify(initialValue)}\n          >\n            {display(options, i)}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n};\n\nconst LoopOptions = ({\n  scale,\n  lowNote,\n  bpm,\n  numBeats,\n  noteRange,\n  setScale,\n  setLowNote,\n  setBpm,\n  setNumBeats,\n  setNoteRange\n}) => {\n\n  const containerStyle = {\n    backgroundColor: GRAY_1 + OPACITY_1,\n    borderColor: GRAY_1,\n  };\n\n  const selectableNotes = scale.notes.filter((note) => {\n    const number = note[note.length - 1];\n    return (number >= 2 && number <= 6); \n  });\n\n  const onChangeLowNote = (e) => {\n    const noteIndex = e.target.value;\n    setLowNote(selectableNotes[noteIndex]);\n  };\n\n  const onChangeScale = (e) => {\n    const scaleIndex = e.target.value;\n    const newScale = SCALES[scaleIndex];\n    const oldLowNoteIndex = scale.notes.indexOf(lowNote);\n    const newLowNote = newScale.notes[oldLowNoteIndex];\n    setScale(newScale);\n    setLowNote(newLowNote);\n  }\n\n  return (\n    <div\n      className={styles.container}\n      style={containerStyle}\n    >\n      <Input\n        label='Tempo (bpm)'\n        type='number'\n        value={bpm}\n        onChange={(e) => setBpm(Number(e.target.value))}\n      />\n      <Input\n        label='Beats per measure'\n        type='number'\n        value={numBeats}\n        onChange={(e) => setNumBeats(Number(e.target.value))}\n      />\n      <Input\n        label='Pitch range'\n        type='number'\n        value={noteRange}\n        onChange={(e) => setNoteRange(Number(e.target.value))}\n      />\n      <Select\n        label='Low note'\n        onChange={onChangeLowNote}\n        initialValue={lowNote}\n        options={selectableNotes}\n        display={(options, i) => options[i]}\n      />\n      <Select\n        label='Scale'\n        onChange={onChangeScale}\n        initialValue={scale}\n        options={SCALES}\n        display={(options, i) => options[i].name}\n      />\n    </div>\n  );\n};\n\nexport default LoopOptions;","import MidiWriter from 'midi-writer-js';\n\nconst msToTicks = (ms, bpm) => {\n  const tempo = Math.round((60 * 1000000) / bpm);\n  const ticksPerBeat = 128;\n  const seconds = ms / 1000;\n  const ticks = Math.round(seconds / (tempo * 1e-6 / ticksPerBeat));\n  return ticks;\n};\n\nexport const toMidiString = ({\n  bpm,\n  tracks,\n  notes\n}) => {\n\n  // BPM times four to represent quarter notes\n  const msPerBeat = (1 / (bpm * 4)) * 60 * 1000;\n\n  const midiTracks = [];\n\n  for (let i = 0; i < tracks.length; i++) {\n    const { noteDuration, disabledBeats } = tracks[i];\n    const midiTrack = new MidiWriter.Track();\n    midiTrack.setTempo(bpm);\n\n    for (let j = 0; j < notes[i].length; j++) {\n      const note = notes[i][j];\n      const isDisabled = disabledBeats.includes(j);\n      const startMs = j * msPerBeat;\n\n      // Don't allow a note's duration to exceed when the next same note begins\n      let maxNoteDuration = Infinity;\n      for (let k = j + 1; k < notes[i].length; k++) {\n        const nextNote = notes[i][k];\n        if (note === nextNote) {\n          const nextStartMs = k * msPerBeat;\n          maxNoteDuration = nextStartMs - startMs - 1;\n          break;\n        }\n      }\n\n      const duration = Math.min(noteDuration, maxNoteDuration);\n\n      if (!isDisabled) {\n        const midiNote = new MidiWriter.NoteEvent({\n          pitch: note,\n          duration: 'T' + msToTicks(duration, bpm),\n          startTick: msToTicks(startMs, bpm)\n        });\n        midiTrack.addEvent(midiNote);\n      }\n    }\n\n    midiTracks.push(midiTrack);\n  }\n\n  const writer = new MidiWriter.Writer(midiTracks);\n  const midiString = writer.dataUri();\n  return midiString;\n};","import { useEffect, useRef, useState } from 'react';\nimport { FaEllipsisV } from 'react-icons/fa';\nimport { GRAY_1, OPACITY_1 } from '../../constants/colors';\nimport { downloadFile } from '../../util/fileDownloader';\nimport { toMidiString } from '../../util/midiWriter';\nimport styles from './More.module.css';\n\nconst ExportToMidi = ({\n  setIsVisible,\n  bpm,\n  tracks,\n  notes,\n}) => {\n  const onClickExportToMidi = () => {\n    setIsVisible(false);\n    const midiString = toMidiString({ bpm, tracks, notes });\n    downloadFile('scaler.mid', midiString);\n  };\n  return (\n    <div\n      onClick={onClickExportToMidi}\n      className={styles.option}\n    >\n      Export to MIDI\n    </div>\n  );\n};\n\nconst OverflowMenu = ({\n  isVisible,\n  setIsVisible,\n  bpm,\n  tracks,\n  notes\n}) => {\n\n  const classes = [styles.overflowMenu];\n  if (!isVisible) {\n    classes.push(styles.hidden);\n  }\n\n  return (\n    <div className={classes.join(' ')}>\n      <ExportToMidi\n        setIsVisible={setIsVisible}\n        bpm={bpm}\n        tracks={tracks}\n        notes={notes}\n      />\n    </div>\n  );\n};\n\nconst More = (props) => {\n\n  const [isVisible, setIsVisible] = useState(false);\n\n  const onClickMore = () => {\n    setIsVisible(!isVisible);\n  };\n\n  // Close menu when user clicks somewhere else\n  const moreRef = useRef(null);\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (moreRef.current && !moreRef.current.contains(e.target)) {\n        setIsVisible(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousdown', handleClickOutside);\n    };\n  }, [moreRef]);\n\n  return (\n    <div\n      ref={moreRef} \n      className={styles.moreContainer}\n    >\n      <div\n        title='More'\n        onClick={onClickMore}\n        className={styles.more}\n        style={{\n          borderColor: GRAY_1,\n          backgroundColor: GRAY_1 + OPACITY_1,\n        }}\n      >\n        <div className={styles.moreIcon}>\n          <FaEllipsisV />\n        </div>\n      </div>\n      <OverflowMenu\n        isVisible={isVisible}\n        setIsVisible={setIsVisible}\n        {...props}\n      />\n    </div>\n  );\n};\n\nexport default More;","export const downloadFile = (filename, textContent) => {\n  const element = document.createElement('a');\n  element.setAttribute('href', textContent);\n  element.setAttribute('download', filename);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n  element.click();\n  document.body.removeChild(element);\n};","import styles from './Play.module.css';\n\nconst Play = ({ isPlaying, setIsPlaying }) => {\n\n  const text = isPlaying ? 'Stop' : 'Play';\n  const playStyle = isPlaying\n    ? {\n      borderColor: '#980031',\n      backgroundColor: '#98003199'\n    }\n    : {\n      borderColor: '#489900',\n      backgroundColor: '#48990099'\n    };\n\n\n  const onPlay = () => {\n    setIsPlaying(!isPlaying);\n  };\n\n  return (\n    <div\n      onClick={onPlay}\n      className={styles.play}\n      style={playStyle}\n    >\n      <div className={styles.playText}>{text}</div>\n    </div>\n  );\n};\n\n\nexport default Play;","import { FaSave } from 'react-icons/fa';\nimport { GRAY_1, OPACITY_1 } from '../../constants/colors';\nimport styles from './Save.module.css';\n\nconst Save = ({ onSave }) => {\n  return (\n    <div\n      title='Save'\n      onClick={onSave}\n      className={styles.save}\n      style={{\n        borderColor: GRAY_1,\n        backgroundColor: GRAY_1 + OPACITY_1,\n      }}\n    >\n      <div className={styles.saveIcon}>\n        <FaSave />\n      </div>\n    </div>\n  );\n};\n\nexport default Save;","import { useEffect, useRef } from 'react';\nimport gsap from 'gsap';\nimport styles from './TimelineArm.module.css';\n\nconst playAnimation = (ref, duration) => {\n  gsap.fromTo(ref, {\n    left: 0,\n    opacity: 1\n  }, {\n    opacity: 1,\n    left: '100%',\n    ease: 'linear',\n    repeat: -1,\n    duration\n  });\n};\n\nconst pauseAnimation = (ref, duration) => {\n  gsap.fromTo(ref, {\n    left: 0,\n    opacity: 0\n  }, {\n    left: 0,\n    opacity: 0,\n    ease: 'linear',\n    repeat: -1,\n    duration\n  });\n};\n\nconst TimelineArm = ({\n  isPlaying,\n  numBeats,\n  bpm,\n  tracks,\n  noteRange,\n  scale,\n  lowNote\n}) => {\n\n  const armRef = useRef(null);\n\n  useEffect(() => {\n\n    // Multiply BPM times four to represent quarter notes\n    const periodDuration = numBeats / (bpm * 4) * 60;\n\n    const animation  = isPlaying ? playAnimation : pauseAnimation;\n    animation(armRef.current, periodDuration);\n  }, [\n    isPlaying,\n    numBeats,\n    bpm,\n    tracks,\n    noteRange,\n    scale,\n    lowNote,\n    armRef\n  ]);\n\n  return (\n    <div\n      ref={armRef}\n      className={styles.arm}\n    ></div>\n  );\n};\n\nexport default TimelineArm;","import styles from './Title.module.css';\n\nconst Title = () => {\n  return (\n    <div className={styles.container}>\n      <div className={styles.text}>\n        SCALER\n      </div>\n      <div className={styles.line} />\n      <a \n        className={styles.link} \n        href='https://github.com/alexcrist/scaler'\n        target='_'  \n      >\n        see the code\n      </a>\n    </div>\n  );\n};\n\nexport default Title;","import { useState } from 'react';\nimport { FaTrash, FaVolumeDown, FaVolumeMute } from 'react-icons/fa';\nimport { OPACITY_1 } from '../../constants/colors';\nimport { formulaToData } from '../../util/formulaEvaluator';\nimport styles from './TrackOptions.module.css';\n\nconst Input = ({ color, index, isError, ...props }) => {\n  const borderColor = color;\n  const style = { borderColor };\n  const classes = [styles.input];\n  if (isError) {\n    classes.push(styles.inputError);\n  }\n  return (\n    <input\n      index={index}\n      className={classes.join(' ')}\n      style={style}\n      {...props}\n    />\n  );\n};\n\nconst Inputs = ({\n  index,\n  track,\n  setTrack\n}) => {\n\n  const { formula, noteDuration } = track;\n\n  let isFormulaValid = true;\n  try {\n    formulaToData(formula, [0, Math.PI]);\n  } catch (e) {\n    isFormulaValid = false;\n  }\n\n  const createAttributeSetter = (attribute) => (e) => {\n    track[attribute] = e.target.value;\n    setTrack(track);\n  };\n\n  return (\n    <div className={styles.editable}>\n\n      <label className={styles.label}>Formula</label>\n      <Input\n        isError={!isFormulaValid}\n        color={track.color}\n        index={index}\n        value={formula}\n        onChange={createAttributeSetter('formula')}\n      />\n\n      <label className={styles.label}>Note duration (ms)</label>\n      <Input\n        color={track.color}\n        index={index}\n        value={noteDuration}\n        onChange={createAttributeSetter('noteDuration')}\n        type='number'\n      />\n    </div>\n  );\n};\n\nconst Icons = ({ \n  isCollapsed,\n  index,\n  track,\n  tracks,\n  setTrack,\n  setTracks,\n}) => {\n  if (isCollapsed) {\n    return null;\n  }\n\n  const onMute = () => {\n    setTrack({\n      ...track,\n      isMuted: !track.isMuted\n    });\n  };\n\n  const onDelete = () => {\n    if (tracks.length === 1) {\n      return;\n    }\n    tracks.splice(index, 1);\n    setTracks([...tracks]);\n  };\n\n  const muteClasses = [styles.icon];\n  if (track.isMuted) {\n    muteClasses.push(styles.isMuted);\n  }\n\n  const MuteIcon = track.isMuted ? FaVolumeMute : FaVolumeDown;\n\n  return (\n    <div className={styles.icons}>\n      <div\n        title='Mute'\n        onClick={onMute}\n        className={muteClasses.join(' ')}\n      >\n        <MuteIcon className={styles.muteIcon} />\n      </div>\n      <div\n        title='Delete'\n        onClick={onDelete}\n        className={styles.icon}\n      >\n        <FaTrash className={styles.trashIcon} />\n      </div>\n    </div>\n  );\n};\n\nconst TrackOptions = ({\n  index,\n  track,\n  tracks,\n  setTracks,\n  setTrack\n}) => {\n\n  const [isCollapsed, setIsCollapsed] = useState(index !== 0);\n\n  const color = track.color;\n  const borderColor = color;\n  const backgroundColor = color + OPACITY_1;\n  const containerStyle = { borderColor, backgroundColor };\n  const containerClasses = [styles.container];\n  if (isCollapsed) {\n    containerClasses.push(styles.collapsed)\n  }\n\n  const onClickContainer = (e) => {\n    setIsCollapsed(!isCollapsed);\n  };\n\n  return (\n    <div\n      style={containerStyle}\n      className={containerClasses.join(' ')}\n    >\n      <div className={styles.header}>\n        <div\n          onClick={onClickContainer} \n          className={styles.title}\n        >\n          Track {index + 1}\n        </div>\n        <Icons\n          index={index}\n          isCollapsed={isCollapsed}\n          track={track}\n          tracks={tracks}\n          setTrack={setTrack}\n          setTracks={setTracks}\n        />\n      </div>\n      {isCollapsed\n        ? null\n        : <Inputs\n            track={track} \n            index={index} \n            setTrack={setTrack} \n          />\n      }\n    </div>\n  );\n};\n\nexport default TrackOptions;","import _ from 'lodash';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { SCALES } from '../../constants/scales';\nimport { saveLocal } from '../../util/localStorage';\nimport { calculateNotes } from '../../util/noteCalculator';\nimport { playScale, stopScale } from '../../util/scalePlayer';\nimport { toHash } from '../../util/stateHasher';\nimport { loadInitialState } from '../../util/stateLoader';\nimport AddTrack from '../AddTrack/AddTrack';\nimport Chart from '../Chart/Chart.js';\nimport EnabledNotes from '../EnabledNotes/EnabledNotes';\nimport LoopOptions from '../LoopOptions/LoopOptions';\nimport More from '../More/More';\nimport Play from '../Play/Play';\nimport Save from '../Save/Save';\nimport TimelineArm from '../TimelineArm/TimelineArm';\nimport Title from '../Title/Title';\nimport TrackOptions from '../TrackOptions/TrackOptions.js';\nimport styles from './App.module.css';\n\nconst App = () => {\n\n  const [tracks, setTracks] = useState([]);\n  const [bpm, setBpm] = useState(60);\n  const [numBeats, setNumBeats] = useState(16);\n  const [noteRange, setNoteRange] = useState(14);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [scale, setScale] = useState(SCALES[3]);\n  const [lowNote, setLowNote] = useState('E3');\n\n  // Calculate notes to play ===================================================\n\n  const notes = useMemo(() => {\n    return calculateNotes(\n      tracks,\n      numBeats,\n      noteRange,\n      scale,\n      lowNote\n    );\n  }, [tracks, numBeats, noteRange, scale, lowNote]);\n\n  // Ref for scale player data =================================================\n\n  const scalePlayerData = useRef({\n    tracks,\n    bpm,\n    notes,\n    numBeats,\n    isPlaying\n  });\n  useEffect(() => {\n    scalePlayerData.current = {\n      tracks,\n      bpm,\n      notes,\n      numBeats,\n      isPlaying,\n    };\n  }, [tracks, bpm, notes, numBeats, isPlaying]);\n\n  // On page load ==============================================================\n\n  useEffect(() => {\n    const {\n      tracks,\n      bpm,\n      numBeats,\n      noteRange,\n      scale,\n      lowNote\n    } = loadInitialState();\n    setTracks(tracks);\n    setBpm(bpm);\n    setNumBeats(numBeats);\n    setNoteRange(noteRange);\n    setScale(scale);\n    setLowNote(lowNote);\n  }, []);\n\n  // Play and pause scale player ===============================================\n\n  useEffect(() => {\n    stopScale();\n    if (isPlaying) {\n      playScale(scalePlayerData);\n    }\n  }, [tracks, bpm, numBeats, noteRange, scale, lowNote, isPlaying]);\n\n  // Save to local storage =====================================================\n\n  useEffect(() => {\n    window.history.pushState({}, '', window.location.origin + window.location.pathname);\n    saveLocal({ bpm, numBeats, noteRange, scale, lowNote, tracks });\n  }, [bpm, numBeats, noteRange, scale, lowNote, tracks]);\n\n  // Event handlers ============================================================\n\n  const onSave = async () => {\n    const hash = toHash({ bpm, numBeats, noteRange, scale, lowNote, tracks });\n    const url = window.location.origin + window.location.pathname + '?d=' + hash;\n    try {\n      await navigator.clipboard.writeText(url);\n      alert('A link to your work has been copied to your clipboard.');\n    } catch (e) {\n      prompt('Save the following URL to access your work:', url);\n    }\n  };\n\n  const createSetTrack = (index) => (track) => {\n    const newTracks = _.cloneDeep(tracks);\n    newTracks[index] = track;\n    setTracks(newTracks);\n  };\n\n  // Page content ==============================================================\n\n  return (\n    <div className={styles.app}>\n      <div>\n\n        <Title />\n\n        <div className={styles.row}>\n\n          {/* Left section ================================================= */}\n          <div className={styles.left}>\n            <div className={styles.chart}>\n              <Chart\n                tracks={tracks}\n                numBeats={numBeats}\n                notes={notes}\n              />\n              <TimelineArm\n                isPlaying={isPlaying}\n                bpm={bpm}\n                numBeats={numBeats}\n                tracks={tracks}\n                noteRange={noteRange}\n                scale={scale}\n                lowNote={lowNote}\n              />\n            </div>\n            {tracks.map((track, index) => (\n              <EnabledNotes\n                key={index}\n                numBeats={numBeats}\n                track={track}\n                setTrack={createSetTrack(index)}\n              />\n            ))}\n          </div>\n\n          {/* Right section ================================================ */}\n          <div className={styles.right}>\n            <div className={styles.buttons}>\n              <Play\n                isPlaying={isPlaying}\n                setIsPlaying={setIsPlaying}\n              />\n              <AddTrack\n                tracks={tracks}\n                setTracks={setTracks}\n              />\n              <Save onSave={onSave} />\n              <More\n                bpm={bpm}\n                tracks={tracks}\n                notes={notes}\n              />\n            </div>\n            {tracks.map((track, index) => (\n              <TrackOptions\n                key={index}\n                index={index}\n                track={track}\n                tracks={tracks}\n                setTrack={createSetTrack(index)}\n                setTracks={setTracks}\n              />\n            ))}\n          </div>\n\n        </div>\n      </div>\n\n      <LoopOptions\n        scale={scale}\n        lowNote={lowNote}\n        bpm={bpm}\n        numBeats={numBeats}\n        noteRange={noteRange}\n        setScale={setScale}\n        setLowNote={setLowNote}\n        setBpm={setBpm}\n        setNumBeats={setNumBeats}\n        setNoteRange={setNoteRange}\n      />\n    </div>\n  )\n}\n\nexport default App;","import _ from 'lodash';\nimport { formulaToData } from './formulaEvaluator';\n\nexport const calculateNotes = (\n  tracks,\n  numBeats,\n  noteRange,\n  scale,\n  lowNote\n) => {\n  const minNoteIndex = scale.notes.indexOf(lowNote);\n\n  const xValues = [];\n  for (let i = 0; i < numBeats; i++) {\n    xValues.push(i / numBeats * 2 * Math.PI);\n  }\n\n  const yValuesArray = tracks.map(({ formula }) => {\n    try {\n      const data = formulaToData(formula, xValues);\n      return data.yValues;\n    } catch (e) {\n      return [];\n    }\n  });\n\n  const yMin = _(yValuesArray).flatten().min();\n  const yMax = _(yValuesArray).flatten().max();\n\n  const notesArray = yValuesArray.map((yValues) => {\n\n    const noteIndices = yValues.map((y) => {\n      return Math.round(\n        (y - yMin) / \n        ((yMax - yMin) || 1) *\n        (noteRange - 1)\n      );\n    });\n\n    const notes = noteIndices.map((index) => {\n      return scale.notes[index + minNoteIndex];\n    });\n\n    return notes;\n  });\n\n  return notesArray;\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App/App';\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"LoopOptions_container__1J57F\",\"inputGroup\":\"LoopOptions_inputGroup__18R54\",\"label\":\"LoopOptions_label__2B8FD\",\"input\":\"LoopOptions_input__19Sav\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"moreContainer\":\"More_moreContainer__3myel\",\"more\":\"More_more__2Crn9\",\"moreIcon\":\"More_moreIcon__l1fRm\",\"overflowMenu\":\"More_overflowMenu__3Dmv8\",\"hidden\":\"More_hidden__HHQiN\",\"option\":\"More_option__1BJ8o\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__1IksY\",\"row\":\"App_row__2IEL-\",\"left\":\"App_left__1u-q5\",\"chart\":\"App_chart__1PrK6\",\"right\":\"App_right__3pQWj\",\"buttons\":\"App_buttons__22Fcg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttons\":\"EnabledNotes_buttons__YuCJP\",\"muted\":\"EnabledNotes_muted__2I7zC\",\"button\":\"EnabledNotes_button__3316l\",\"disabled\":\"EnabledNotes_disabled__1W2ff\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Title_container__e3k5b\",\"text\":\"Title_text__39Uar\",\"link\":\"Title_link__2onV0\",\"line\":\"Title_line__1RmyE\"};"],"sourceRoot":""}